<!DOCTYPE html>
<html><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <link rel="shortcut icon" href="../favicon.ico">
    <title>Phillip Mates :: Modeling "The Essence of Compiling with Continuations"</title>

    <link rel="stylesheet" href="Modeling%20%22The%20Essence%20of%20Compiling%20with%20Continuations%22_files/main.css">

    <link rel="alternate" type="application/atom+xml" href="../articles.atom" title="Cube of Lambda feed">

    <style type="text/css">.MathJax_Hover_Frame {border-radius: .25em; -webkit-border-radius: .25em; -moz-border-radius: .25em; -khtml-border-radius: .25em; box-shadow: 0px 0px 15px #83A; -webkit-box-shadow: 0px 0px 15px #83A; -moz-box-shadow: 0px 0px 15px #83A; -khtml-box-shadow: 0px 0px 15px #83A; border: 1px solid #A6D ! important; display: inline-block; position: absolute}
.MathJax_Menu_Button .MathJax_Hover_Arrow {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 4px; -webkit-border-radius: 4px; -moz-border-radius: 4px; -khtml-border-radius: 4px; font-family: 'Courier New',Courier; font-size: 9px; color: #F0F0F0}
.MathJax_Menu_Button .MathJax_Hover_Arrow span {display: block; background-color: #AAA; border: 1px solid; border-radius: 3px; line-height: 0; padding: 4px}
.MathJax_Hover_Arrow:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_Hover_Arrow:hover span {background-color: #CCC!important}
</style><style type="text/css">#MathJax_About {position: fixed; left: 50%; width: auto; text-align: center; border: 3px outset; padding: 1em 2em; background-color: #DDDDDD; color: black; cursor: default; font-family: message-box; font-size: 120%; font-style: normal; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; border-radius: 15px; -webkit-border-radius: 15px; -moz-border-radius: 15px; -khtml-border-radius: 15px; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_About.MathJax_MousePost {outline: none}
.MathJax_Menu {position: absolute; background-color: white; color: black; width: auto; padding: 5px 0px; border: 1px solid #CCCCCC; margin: 0; cursor: default; font: menu; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; border-radius: 5px; -webkit-border-radius: 5px; -moz-border-radius: 5px; -khtml-border-radius: 5px; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
.MathJax_MenuItem {padding: 1px 2em; background: transparent}
.MathJax_MenuArrow {position: absolute; right: .5em; padding-top: .25em; color: #666666; font-size: .75em}
.MathJax_MenuActive .MathJax_MenuArrow {color: white}
.MathJax_MenuArrow.RTL {left: .5em; right: auto}
.MathJax_MenuCheck {position: absolute; left: .7em}
.MathJax_MenuCheck.RTL {right: .7em; left: auto}
.MathJax_MenuRadioCheck {position: absolute; left: .7em}
.MathJax_MenuRadioCheck.RTL {right: .7em; left: auto}
.MathJax_MenuLabel {padding: 1px 2em 3px 1.33em; font-style: italic}
.MathJax_MenuRule {border-top: 1px solid #DDDDDD; margin: 4px 3px}
.MathJax_MenuDisabled {color: GrayText}
.MathJax_MenuActive {background-color: #606872; color: white}
.MathJax_MenuDisabled:focus, .MathJax_MenuLabel:focus {background-color: #E8E8E8}
.MathJax_ContextMenu:focus {outline: none}
.MathJax_ContextMenu .MathJax_MenuItem:focus {outline: none}
#MathJax_AboutClose {top: .2em; right: .2em}
.MathJax_Menu .MathJax_MenuClose {top: -10px; left: -10px}
.MathJax_MenuClose {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; font-family: 'Courier New',Courier; font-size: 24px; color: #F0F0F0}
.MathJax_MenuClose span {display: block; background-color: #AAA; border: 1.5px solid; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; line-height: 0; padding: 8px 0 6px}
.MathJax_MenuClose:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_MenuClose:hover span {background-color: #CCC!important}
.MathJax_MenuClose:hover:focus {outline: none}
</style><style type="text/css">.MathJax_Preview .MJXf-math {color: inherit!important}
</style><style type="text/css">.MJX_Assistive_MathML {position: absolute!important; top: 0; left: 0; clip: rect(1px, 1px, 1px, 1px); padding: 1px 0 0 0!important; border: 0!important; height: 1px!important; width: 1px!important; overflow: hidden!important; display: block!important; -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none}
.MJX_Assistive_MathML.MJX_Assistive_MathML_Block {width: 100%!important}
</style><style type="text/css">#MathJax_Zoom {position: absolute; background-color: #F0F0F0; overflow: auto; display: block; z-index: 301; padding: .5em; border: 1px solid black; margin: 0; font-weight: normal; font-style: normal; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; -webkit-box-sizing: content-box; -moz-box-sizing: content-box; box-sizing: content-box; box-shadow: 5px 5px 15px #AAAAAA; -webkit-box-shadow: 5px 5px 15px #AAAAAA; -moz-box-shadow: 5px 5px 15px #AAAAAA; -khtml-box-shadow: 5px 5px 15px #AAAAAA; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_ZoomOverlay {position: absolute; left: 0; top: 0; z-index: 300; display: inline-block; width: 100%; height: 100%; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
#MathJax_ZoomFrame {position: relative; display: inline-block; height: 0; width: 0}
#MathJax_ZoomEventTrap {position: absolute; left: 0; top: 0; z-index: 302; display: inline-block; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
</style><style type="text/css">.MathJax_Preview {color: #888}
#MathJax_Message {position: fixed; left: 1px; bottom: 2px; background-color: #E6E6E6; border: 1px solid #959595; margin: 0px; padding: 2px 8px; z-index: 102; color: black; font-size: 80%; width: auto; white-space: nowrap}
#MathJax_MSIE_Frame {position: absolute; top: 0; left: 0; width: 0px; z-index: 101; border: 0px; margin: 0px; padding: 0px}
.MathJax_Error {color: #CC0000; font-style: italic}
</style><style type="text/css">.MJXp-script {font-size: .8em}
.MJXp-right {-webkit-transform-origin: right; -moz-transform-origin: right; -ms-transform-origin: right; -o-transform-origin: right; transform-origin: right}
.MJXp-bold {font-weight: bold}
.MJXp-italic {font-style: italic}
.MJXp-scr {font-family: MathJax_Script,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-frak {font-family: MathJax_Fraktur,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-sf {font-family: MathJax_SansSerif,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-cal {font-family: MathJax_Caligraphic,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-mono {font-family: MathJax_Typewriter,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-largeop {font-size: 150%}
.MJXp-largeop.MJXp-int {vertical-align: -.2em}
.MJXp-math {display: inline-block; line-height: 1.2; text-indent: 0; font-family: 'Times New Roman',Times,STIXGeneral,serif; white-space: nowrap; border-collapse: collapse}
.MJXp-display {display: block; text-align: center; margin: 1em 0}
.MJXp-math span {display: inline-block}
.MJXp-box {display: block!important; text-align: center}
.MJXp-box:after {content: " "}
.MJXp-rule {display: block!important; margin-top: .1em}
.MJXp-char {display: block!important}
.MJXp-mo {margin: 0 .15em}
.MJXp-mfrac {margin: 0 .125em; vertical-align: .25em}
.MJXp-denom {display: inline-table!important; width: 100%}
.MJXp-denom > * {display: table-row!important}
.MJXp-surd {vertical-align: top}
.MJXp-surd > * {display: block!important}
.MJXp-script-box > *  {display: table!important; height: 50%}
.MJXp-script-box > * > * {display: table-cell!important; vertical-align: top}
.MJXp-script-box > *:last-child > * {vertical-align: bottom}
.MJXp-script-box > * > * > * {display: block!important}
.MJXp-mphantom {visibility: hidden}
.MJXp-munderover {display: inline-table!important}
.MJXp-over {display: inline-block!important; text-align: center}
.MJXp-over > * {display: block!important}
.MJXp-munderover > * {display: table-row!important}
.MJXp-mtable {vertical-align: .25em; margin: 0 .125em}
.MJXp-mtable > * {display: inline-table!important; vertical-align: middle}
.MJXp-mtr {display: table-row!important}
.MJXp-mtd {display: table-cell!important; text-align: center; padding: .5em 0 0 .5em}
.MJXp-mtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-mlabeledtr {display: table-row!important}
.MJXp-mlabeledtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mlabeledtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-merror {background-color: #FFFF88; color: #CC0000; border: 1px solid #CC0000; padding: 1px 3px; font-style: normal; font-size: 90%}
.MJXp-scale0 {-webkit-transform: scaleX(.0); -moz-transform: scaleX(.0); -ms-transform: scaleX(.0); -o-transform: scaleX(.0); transform: scaleX(.0)}
.MJXp-scale1 {-webkit-transform: scaleX(.1); -moz-transform: scaleX(.1); -ms-transform: scaleX(.1); -o-transform: scaleX(.1); transform: scaleX(.1)}
.MJXp-scale2 {-webkit-transform: scaleX(.2); -moz-transform: scaleX(.2); -ms-transform: scaleX(.2); -o-transform: scaleX(.2); transform: scaleX(.2)}
.MJXp-scale3 {-webkit-transform: scaleX(.3); -moz-transform: scaleX(.3); -ms-transform: scaleX(.3); -o-transform: scaleX(.3); transform: scaleX(.3)}
.MJXp-scale4 {-webkit-transform: scaleX(.4); -moz-transform: scaleX(.4); -ms-transform: scaleX(.4); -o-transform: scaleX(.4); transform: scaleX(.4)}
.MJXp-scale5 {-webkit-transform: scaleX(.5); -moz-transform: scaleX(.5); -ms-transform: scaleX(.5); -o-transform: scaleX(.5); transform: scaleX(.5)}
.MJXp-scale6 {-webkit-transform: scaleX(.6); -moz-transform: scaleX(.6); -ms-transform: scaleX(.6); -o-transform: scaleX(.6); transform: scaleX(.6)}
.MJXp-scale7 {-webkit-transform: scaleX(.7); -moz-transform: scaleX(.7); -ms-transform: scaleX(.7); -o-transform: scaleX(.7); transform: scaleX(.7)}
.MJXp-scale8 {-webkit-transform: scaleX(.8); -moz-transform: scaleX(.8); -ms-transform: scaleX(.8); -o-transform: scaleX(.8); transform: scaleX(.8)}
.MJXp-scale9 {-webkit-transform: scaleX(.9); -moz-transform: scaleX(.9); -ms-transform: scaleX(.9); -o-transform: scaleX(.9); transform: scaleX(.9)}
.MathJax_PHTML .noError {vertical-align: ; font-size: 90%; text-align: left; color: black; padding: 1px 3px; border: 1px solid}
</style><style type="text/css">.MathJax_Display {text-align: center; margin: 1em 0em; position: relative; display: block!important; text-indent: 0; max-width: none; max-height: none; min-width: 0; min-height: 0; width: 100%}
.MathJax .merror {background-color: #FFFF88; color: #CC0000; border: 1px solid #CC0000; padding: 1px 3px; font-style: normal; font-size: 90%}
.MathJax .MJX-monospace {font-family: monospace}
.MathJax .MJX-sans-serif {font-family: sans-serif}
#MathJax_Tooltip {background-color: InfoBackground; color: InfoText; border: 1px solid black; box-shadow: 2px 2px 5px #AAAAAA; -webkit-box-shadow: 2px 2px 5px #AAAAAA; -moz-box-shadow: 2px 2px 5px #AAAAAA; -khtml-box-shadow: 2px 2px 5px #AAAAAA; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true'); padding: 3px 4px; z-index: 401; position: absolute; left: 0; top: 0; width: auto; height: auto; display: none}
.MathJax {display: inline; font-style: normal; font-weight: normal; line-height: normal; font-size: 100%; font-size-adjust: none; text-indent: 0; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0; min-height: 0; border: 0; padding: 0; margin: 0}
.MathJax:focus, body :focus .MathJax {display: inline-table}
.MathJax.MathJax_FullWidth {text-align: center; display: table-cell!important; width: 10000em!important}
.MathJax img, .MathJax nobr, .MathJax a {border: 0; padding: 0; margin: 0; max-width: none; max-height: none; min-width: 0; min-height: 0; vertical-align: 0; line-height: normal; text-decoration: none}
img.MathJax_strut {border: 0!important; padding: 0!important; margin: 0!important; vertical-align: 0!important}
.MathJax span {display: inline; position: static; border: 0; padding: 0; margin: 0; vertical-align: 0; line-height: normal; text-decoration: none}
.MathJax nobr {white-space: nowrap!important}
.MathJax img {display: inline!important; float: none!important}
.MathJax * {transition: none; -webkit-transition: none; -moz-transition: none; -ms-transition: none; -o-transition: none}
.MathJax_Processing {visibility: hidden; position: fixed; width: 0; height: 0; overflow: hidden}
.MathJax_Processed {display: none!important}
.MathJax_ExBox {display: block!important; overflow: hidden; width: 1px; height: 60ex; min-height: 0; max-height: none}
.MathJax .MathJax_EmBox {display: block!important; overflow: hidden; width: 1px; height: 60em; min-height: 0; max-height: none}
.MathJax_LineBox {display: table!important}
.MathJax_LineBox span {display: table-cell!important; width: 10000em!important; min-width: 0; max-width: none; padding: 0; border: 0; margin: 0}
.MathJax .MathJax_HitBox {cursor: text; background: white; opacity: 0; filter: alpha(opacity=0)}
.MathJax .MathJax_HitBox * {filter: none; opacity: 1; background: transparent}
#MathJax_Tooltip * {filter: none; opacity: 1; background: transparent}
@font-face {font-family: MathJax_Main; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Main-Regular.woff?V=2.7.1') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Main-Regular.otf?V=2.7.1') format('opentype')}
@font-face {font-family: MathJax_Main; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Main-Bold.woff?V=2.7.1') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Main-Bold.otf?V=2.7.1') format('opentype'); font-weight: bold}
@font-face {font-family: MathJax_Main; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Main-Italic.woff?V=2.7.1') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Main-Italic.otf?V=2.7.1') format('opentype'); font-style: italic}
@font-face {font-family: MathJax_Math; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Math-Italic.woff?V=2.7.1') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Math-Italic.otf?V=2.7.1') format('opentype'); font-style: italic}
@font-face {font-family: MathJax_Caligraphic; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Caligraphic-Regular.woff?V=2.7.1') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Caligraphic-Regular.otf?V=2.7.1') format('opentype')}
@font-face {font-family: MathJax_Size1; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Size1-Regular.woff?V=2.7.1') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Size1-Regular.otf?V=2.7.1') format('opentype')}
@font-face {font-family: MathJax_Size2; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Size2-Regular.woff?V=2.7.1') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Size2-Regular.otf?V=2.7.1') format('opentype')}
@font-face {font-family: MathJax_Size3; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Size3-Regular.woff?V=2.7.1') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Size3-Regular.otf?V=2.7.1') format('opentype')}
@font-face {font-family: MathJax_Size4; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Size4-Regular.woff?V=2.7.1') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Size4-Regular.otf?V=2.7.1') format('opentype')}
.MathJax .noError {vertical-align: ; font-size: 90%; text-align: left; color: black; padding: 1px 3px; border: 1px solid}
</style></head><body><div style="visibility: hidden; overflow: hidden; position: absolute; top: 0px; height: 1px; width: auto; padding: 0px; border: 0px none; margin: 0px; text-align: left; text-indent: 0px; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal;"><div id="MathJax_Hidden"></div></div><div id="MathJax_Message" style="display: none;"></div>
    <header id="header"><div class="wrapper">
      <h1 id="title"><a href="../">Phillip Mates</a></h1>

      <ul id="navigation">
        <li><a href="../blog.html">Blog</a></li>
        <li><a href="../projects">Projects</a></li>
        <li><a href="../publications">Pubs</a></li>
      </ul>
    </div></header>

    <section id="main" class="wrapper">
<article>
    <h1>Modeling "The Essence of Compiling with Continuations"</h1>

    <p class="date">December  6, 2012</p>

    <p>Understanding technical papers is difficult. It is easy to 
convince yourself that you understand a paper, but even easier to 
shatter this illusion by attempting to run through the paper’s figures 
by hand. Figures often contain subtleties, omissions, and unfortunately 
typos that need to be digested and worked through.</p>
<p>This became apparent to me while working through the classic paper “<a href="https://dl.acm.org/citation.cfm?id=155113">The Essence of Compiling with Continuations</a>” for <a href="http://www.ccs.neu.edu/home/matthias/">Matthias Felleisen</a>'s <a href="http://www.ccs.neu.edu/home/matthias/7400-f12/">Principles of Programming Languages</a> course. As a means to better comprehend this paper, my project partner <a href="http://www.ccs.neu.edu/home/ejs/">Erik Silkensen</a> and I mechanically modeled the paper's figures in <a href="http://redex.racket-lang.org/">Redex</a>.</p>
<p>In this post I will present the paper and link to the corresponding executable models that can be <a href="https://github.com/esilkensen/cwc">found on GitHub</a> as I go.</p>
<h2 id="continuation-passing-style-cps">Continuation passing style (CPS)</h2>
<p>Compilers transform high level source languages, such as Java or 
Haskell into lower level target languages, such as JVM or LLVM. 
Intermediate language forms are often used to enable the application of 
generalized optimizations. A popular intermediate form is continuation 
passing style (CPS), in which procedures don't return but pass their 
result to a caller-provided continuation or call-back function. Take for
 instance, a function <code>add1 = λ x . (+ x 1)</code>, in CPS it would look like <code>add1' = λ x k . (k (+ x 1))</code>, where <code>k</code>
 is the provided continuation. Aside from enabling many optimizations, 
CPS makes control flow of programs explicit and is easy to translate 
into assembly. For more intuition on CPS, Matt Might has several 
excellent articles on <a href="http://matt.might.net/articles/by-example-continuation-passing-style/">CPS by example</a>, <a href="http://matt.might.net/articles/cps-conversion/">compiling with CPS</a> and <a href="http://matt.might.net/articles/programming-with-continuations--exceptions-backtracking-search-threads-generators-coroutines/">implementing language features using CPS</a>.</p>
<h2 id="the-essence-of-compiling-with-continuations">The Essence of Compiling with Continuations</h2>
<p>An optimizing CPS transformation usually takes multiple passes. Flanagan et. al. show in “<a href="https://dl.acm.org/citation.cfm?id=155113">The Essence of Compiling with Continuations</a>”
 that one can forgo a standard 3-pass CPS transformation while still 
capturing the essence of compiling with continuations by doing a single 
source level transformation to A-Normal Form (ANF).</p>
<p>To show this, the authors present a Scheme-like language CS, CPS 
convert it into the CPS(CS) language. Then they incrementally optimize 
an abstract machine that operates over the CPS(CS) language, arriving at
 the <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-1-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math display=&quot;inline&quot; xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;mrow&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mi&gt;E&lt;/mi&gt;&lt;mi&gt;K&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1" style="width: 4.602em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.463em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.297em, 1003.46em, 2.614em, -1000em); top: -2.165em; left: 0em;"><span class="mrow" id="MathJax-Span-2"><span class="mrow" id="MathJax-Span-3"><span class="msub" id="MathJax-Span-4"><span style="display: inline-block; position: relative; width: 1.783em; height: 0px;"><span style="position: absolute; clip: rect(3.137em, 1000.76em, 4.189em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-5" style="font-family: MathJax_Math; font-style: italic;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.045em;"></span></span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.715em;"><span class="mrow" id="MathJax-Span-6"><span class="mi" id="MathJax-Span-7" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">c</span><span class="mi" id="MathJax-Span-8" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">p</span><span class="mi" id="MathJax-Span-9" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">s</span></span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span><span class="mi" id="MathJax-Span-10" style="font-family: MathJax_Math; font-style: italic;">E<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.026em;"></span></span><span class="mi" id="MathJax-Span-11" style="font-family: MathJax_Math; font-style: italic;">K<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.04em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.165em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.451em; border-left: 0px solid; width: 0px; height: 1.453em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><mrow><msub><mi>C</mi><mrow><mi>c</mi><mi>p</mi><mi>s</mi></mrow></msub><mi>E</mi><mi>K</mi></mrow></math></span></span><script type="math/mml" id="MathJax-Element-1"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><mrow><msub><mi>C</mi><mrow><mi>c</mi><mi>p</mi><mi>s</mi></mrow></msub><mi>E</mi><mi>K</mi></mrow></math></script> machine. To close they prove its equivalence to the <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-2-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math display=&quot;inline&quot; xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;/msub&gt;&lt;mi&gt;E&lt;/mi&gt;&lt;mi&gt;K&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-12" style="width: 3.791em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.868em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.297em, 1002.87em, 2.484em, -1000em); top: -2.165em; left: 0em;"><span class="mrow" id="MathJax-Span-13"><span class="mrow" id="MathJax-Span-14"><span class="msub" id="MathJax-Span-15"><span style="display: inline-block; position: relative; width: 1.164em; height: 0px;"><span style="position: absolute; clip: rect(3.137em, 1000.76em, 4.189em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-16" style="font-family: MathJax_Math; font-style: italic;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.045em;"></span></span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.715em;"><span class="mi" id="MathJax-Span-17" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">a</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span><span class="mi" id="MathJax-Span-18" style="font-family: MathJax_Math; font-style: italic;">E<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.026em;"></span></span><span class="mi" id="MathJax-Span-19" style="font-family: MathJax_Math; font-style: italic;">K<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.04em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.165em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.279em; border-left: 0px solid; width: 0px; height: 1.281em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><mrow><msub><mi>C</mi><mi>a</mi></msub><mi>E</mi><mi>K</mi></mrow></math></span></span><script type="math/mml" id="MathJax-Element-2"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><mrow><msub><mi>C</mi><mi>a</mi></msub><mi>E</mi><mi>K</mi></mrow></math></script> machine, which operates over ANF programs in the A(CS) language.</p>
<p>Below is the initial Scheme-like <a href="https://github.com/esilkensen/cwc/blob/master/src/cs.rkt#L11">CS Language</a>, which has expressions <code>M</code>, values <code>V</code> and operations <code>O</code>.</p>
<pre><code>M ::= V | (let (x M) M) | (if0 M M M) | (M M ...) | (O M ...)
V ::= number | x | (λ (x ...) M)
O ::= + | - | * | /</code></pre>
<h2 id="cps-transformations">CPS transformations</h2>
<p>To convert the CS language into CPS, we begin with the <a href="https://github.com/esilkensen/cwc/blob/master/src/cps.rkt#L62">naive CPS translation F</a> that adds continuation to terms in the language.</p>
<pre><code>F[V]               = λ k . (k Φ[V])
F[(let (x M1) M2)] = λ k . (F[M1] (λ t . (let (x t) (F[M2] k))))
F[(if0 M1 M2 M3)]  = λ k . (F[M1] (λ t . (if0 t (F[M2] k) (F[M3] k))))
F[(M M1)]          = λ k . (F[M] (λ t . (F[M1] (λ t1 . (t k t1)))))
F[(0 M)]           = λ k . (F[M] (λ t . (O' k t)))))</code></pre>
<pre><code>Φ[c]       = c
Φ[x]       = x
Φ[λ x . M] = λ k x . (F[M] k)</code></pre>
<p>It is naive because it introduces many administrative <code>λ</code> terms that can be simplified away by applying β-reductions. For instance, <code>F(λ x . x)</code> will result in:</p>
<pre><code>(λ k3 . (k3 (λ k2 x . ((λ k1 . ((λ k . (k x)) (λ t . (t k1)))) k2))))</code></pre>
<p>which can then be simplified to:</p>
<pre><code>(λ k3 . (k3 (λ k2 x . (x k2))))</code></pre>
<p>by applying β-reductions to <code>λ</code>s introduced by the <code>F</code> function wherever possible.</p>
<p>The resulting language after applying the <code>F</code> function to CS terms is <a href="https://github.com/esilkensen/cwc/blob/master/src/cps.rkt#L11">CPS(CS)</a>, where there are expressions <code>P</code>, values <code>W</code> and the CPS equivalent of operators found in CS <code>O'</code>:</p>
<pre><code>P  ::= (k W) | (let (x W) P) | (if0 W P P)
     | (W k W ...) | (W (λ (x) P) W ...)
     | (O' k W ...) | (O' (λ (x) P) W ...)
W  ::= number | x | (λ (k x ...) P)
O' ::= +' | -' | *' | /'</code></pre>
<h2 id="optimizing-abstract-machines-for-cpscs">Optimizing abstract machines for CPS(CS)</h2>
<p>Continuations are explicitly present in terms of the CPS(CS) 
language, hence control and environment are the only components needed 
to create an abstract machine capable of evaluating CPS(CS) programs. 
The authors begin with such a machine, the <a href="https://github.com/esilkensen/cwc/blob/master/src/cps-ce.rkt#L27"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-3-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math display=&quot;inline&quot; xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;mrow&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mi&gt;E&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-20" style="width: 3.358em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.543em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.297em, 1002.54em, 2.614em, -1000em); top: -2.165em; left: 0em;"><span class="mrow" id="MathJax-Span-21"><span class="mrow" id="MathJax-Span-22"><span class="msub" id="MathJax-Span-23"><span style="display: inline-block; position: relative; width: 1.783em; height: 0px;"><span style="position: absolute; clip: rect(3.137em, 1000.76em, 4.189em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-24" style="font-family: MathJax_Math; font-style: italic;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.045em;"></span></span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.715em;"><span class="mrow" id="MathJax-Span-25"><span class="mi" id="MathJax-Span-26" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">c</span><span class="mi" id="MathJax-Span-27" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">p</span><span class="mi" id="MathJax-Span-28" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">s</span></span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span><span class="mi" id="MathJax-Span-29" style="font-family: MathJax_Math; font-style: italic;">E<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.026em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.165em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.451em; border-left: 0px solid; width: 0px; height: 1.453em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><mrow><msub><mi>C</mi><mrow><mi>c</mi><mi>p</mi><mi>s</mi></mrow></msub><mi>E</mi></mrow></math></span></span><script type="math/mml" id="MathJax-Element-3"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><mrow><msub><mi>C</mi><mrow><mi>c</mi><mi>p</mi><mi>s</mi></mrow></msub><mi>E</mi></mrow></math></script></a>
 machine, but quickly notice that continuation variables are often 
redundantly bound in the environment. There is no need when evaluating <code>((λ k1 x . P) k2 y)</code> to bind <code>k1 := k2</code> in the environment since they point to the same continuation. Addressing this, a control stack is added, resulting in a <a href="https://github.com/esilkensen/cwc/blob/master/src/cps-cek.rkt#L28"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-4-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math display=&quot;inline&quot; xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;mrow&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mi&gt;E&lt;/mi&gt;&lt;mi&gt;K&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-30" style="width: 4.602em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.463em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.297em, 1003.46em, 2.614em, -1000em); top: -2.165em; left: 0em;"><span class="mrow" id="MathJax-Span-31"><span class="mrow" id="MathJax-Span-32"><span class="msub" id="MathJax-Span-33"><span style="display: inline-block; position: relative; width: 1.783em; height: 0px;"><span style="position: absolute; clip: rect(3.137em, 1000.76em, 4.189em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-34" style="font-family: MathJax_Math; font-style: italic;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.045em;"></span></span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.715em;"><span class="mrow" id="MathJax-Span-35"><span class="mi" id="MathJax-Span-36" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">c</span><span class="mi" id="MathJax-Span-37" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">p</span><span class="mi" id="MathJax-Span-38" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">s</span></span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span><span class="mi" id="MathJax-Span-39" style="font-family: MathJax_Math; font-style: italic;">E<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.026em;"></span></span><span class="mi" id="MathJax-Span-40" style="font-family: MathJax_Math; font-style: italic;">K<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.04em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.165em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.451em; border-left: 0px solid; width: 0px; height: 1.453em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><mrow><msub><mi>C</mi><mrow><mi>c</mi><mi>p</mi><mi>s</mi></mrow></msub><mi>E</mi><mi>K</mi></mrow></math></span></span><script type="math/mml" id="MathJax-Element-4"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><mrow><msub><mi>C</mi><mrow><mi>c</mi><mi>p</mi><mi>s</mi></mrow></msub><mi>E</mi><mi>K</mi></mrow></math></script></a>
 machine in which continuations are no longer stored in the state's 
environment. From there they notice that since the machine is keeping 
track of the program's continuations, continuation variables found in 
CPS(CS) terms are not used to lookup continuations in the environment. 
Hence an unCPS transformation is designed to remove explicit 
continuations from terms and a subsequent <a href="https://github.com/esilkensen/cwc/blob/master/src/a-cek.rkt#L28"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-5-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math display=&quot;inline&quot; xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;/msub&gt;&lt;mi&gt;E&lt;/mi&gt;&lt;mi&gt;K&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-41" style="width: 3.791em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.868em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.297em, 1002.87em, 2.484em, -1000em); top: -2.165em; left: 0em;"><span class="mrow" id="MathJax-Span-42"><span class="mrow" id="MathJax-Span-43"><span class="msub" id="MathJax-Span-44"><span style="display: inline-block; position: relative; width: 1.164em; height: 0px;"><span style="position: absolute; clip: rect(3.137em, 1000.76em, 4.189em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-45" style="font-family: MathJax_Math; font-style: italic;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.045em;"></span></span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.715em;"><span class="mi" id="MathJax-Span-46" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">a</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span><span class="mi" id="MathJax-Span-47" style="font-family: MathJax_Math; font-style: italic;">E<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.026em;"></span></span><span class="mi" id="MathJax-Span-48" style="font-family: MathJax_Math; font-style: italic;">K<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.04em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.165em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.279em; border-left: 0px solid; width: 0px; height: 1.281em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><mrow><msub><mi>C</mi><mi>a</mi></msub><mi>E</mi><mi>K</mi></mrow></math></span></span><script type="math/mml" id="MathJax-Element-5"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><mrow><msub><mi>C</mi><mi>a</mi></msub><mi>E</mi><mi>K</mi></mrow></math></script></a> machine is formulated.</p>
<h2 id="uncps">UnCPS</h2>
<p>In the <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-6-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math display=&quot;inline&quot; xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;mrow&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mi&gt;E&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-49" style="width: 3.358em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.543em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.297em, 1002.54em, 2.614em, -1000em); top: -2.165em; left: 0em;"><span class="mrow" id="MathJax-Span-50"><span class="mrow" id="MathJax-Span-51"><span class="msub" id="MathJax-Span-52"><span style="display: inline-block; position: relative; width: 1.783em; height: 0px;"><span style="position: absolute; clip: rect(3.137em, 1000.76em, 4.189em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-53" style="font-family: MathJax_Math; font-style: italic;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.045em;"></span></span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.715em;"><span class="mrow" id="MathJax-Span-54"><span class="mi" id="MathJax-Span-55" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">c</span><span class="mi" id="MathJax-Span-56" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">p</span><span class="mi" id="MathJax-Span-57" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">s</span></span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span><span class="mi" id="MathJax-Span-58" style="font-family: MathJax_Math; font-style: italic;">E<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.026em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.165em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.451em; border-left: 0px solid; width: 0px; height: 1.453em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><mrow><msub><mi>C</mi><mrow><mi>c</mi><mi>p</mi><mi>s</mi></mrow></msub><mi>E</mi></mrow></math></span></span><script type="math/mml" id="MathJax-Element-6"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><mrow><msub><mi>C</mi><mrow><mi>c</mi><mi>p</mi><mi>s</mi></mrow></msub><mi>E</mi></mrow></math></script> machine, the continuation variables found in terms are used to lookup continuations in the environment. Migrating to the <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-7-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math display=&quot;inline&quot; xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;mrow&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mi&gt;E&lt;/mi&gt;&lt;mi&gt;K&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-59" style="width: 4.602em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.463em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.297em, 1003.46em, 2.614em, -1000em); top: -2.165em; left: 0em;"><span class="mrow" id="MathJax-Span-60"><span class="mrow" id="MathJax-Span-61"><span class="msub" id="MathJax-Span-62"><span style="display: inline-block; position: relative; width: 1.783em; height: 0px;"><span style="position: absolute; clip: rect(3.137em, 1000.76em, 4.189em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-63" style="font-family: MathJax_Math; font-style: italic;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.045em;"></span></span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.715em;"><span class="mrow" id="MathJax-Span-64"><span class="mi" id="MathJax-Span-65" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">c</span><span class="mi" id="MathJax-Span-66" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">p</span><span class="mi" id="MathJax-Span-67" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">s</span></span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span><span class="mi" id="MathJax-Span-68" style="font-family: MathJax_Math; font-style: italic;">E<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.026em;"></span></span><span class="mi" id="MathJax-Span-69" style="font-family: MathJax_Math; font-style: italic;">K<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.04em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.165em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.451em; border-left: 0px solid; width: 0px; height: 1.453em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><mrow><msub><mi>C</mi><mrow><mi>c</mi><mi>p</mi><mi>s</mi></mrow></msub><mi>E</mi><mi>K</mi></mrow></math></span></span><script type="math/mml" id="MathJax-Element-7"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><mrow><msub><mi>C</mi><mrow><mi>c</mi><mi>p</mi><mi>s</mi></mrow></msub><mi>E</mi><mi>K</mi></mrow></math></script>
 machine means that these continuations are already managed by the 
state's control stack. This leaves continuation variables in terms 
useless, so let's drop them. What about the remaining terms that have 
with continuations of the form <code>λ x . P</code>? These can be transformed into <code>let</code> expressions by binding the current computation to the continuation's free <code>x</code> and putting the continuation body in the body of the <code>let</code>:</p>
<pre><code>(W (λ x . P) W ...) → (let (x (W W ...)) P)</code></pre>
<p>Doing so means that continuations are no longer passed around but 
become the surrounding context, syntactically linearizing the program. 
This continuation removal transformation can be formalized as the <a href="https://github.com/esilkensen/cwc/blob/master/src/a.rkt#L31"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-8-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math display=&quot;inline&quot; xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow&gt;&lt;mi&gt;U&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-70" style="width: 1.085em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.812em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.319em, 1000.81em, 2.349em, -1000em); top: -2.165em; left: 0em;"><span class="mrow" id="MathJax-Span-71"><span class="mrow" id="MathJax-Span-72"><span class="mi" id="MathJax-Span-73" style="font-family: MathJax_Math; font-style: italic;">U<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.084em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.165em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.1em; border-left: 0px solid; width: 0px; height: 1.073em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mi>U</mi></mrow></math></span></span><script type="math/mml" id="MathJax-Element-8"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mi>U</mi></mrow></math></script> metafunction</a> found in our Redex models. For instance applying <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-9-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math display=&quot;inline&quot; xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow&gt;&lt;mi&gt;U&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-74" style="width: 1.085em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.812em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.319em, 1000.81em, 2.349em, -1000em); top: -2.165em; left: 0em;"><span class="mrow" id="MathJax-Span-75"><span class="mrow" id="MathJax-Span-76"><span class="mi" id="MathJax-Span-77" style="font-family: MathJax_Math; font-style: italic;">U<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.084em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.165em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.1em; border-left: 0px solid; width: 0px; height: 1.073em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mi>U</mi></mrow></math></span></span><script type="math/mml" id="MathJax-Element-9"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mi>U</mi></mrow></math></script> to the following CPS expression:</p>
<pre><code>(+' (λ t1 . (let (x 1) (f (λ t2 . (+' k t1 t2)) x))) 2 2)</code></pre>
<p>results in the following CS expression:</p>
<pre><code>(let (t1 (+ 2 2))
  (let (x 1)
    (let (t2 (f x)))
      (+ t1 t2)))</code></pre>
<p>The range of this function is the A(CS) language, which is a stricter subset of the CS language.</p>
<h2 id="a-normal-form-anf-language">A-Normal Form (ANF) language</h2>
<pre><code>M ::= V | (let (x V) M) | (if0 V M M)
    | (V V ...) | (let (x (V V ...)) M)
    | (O V ...) | (let (x (O V ...)) M)
V ::= number | x | (λ (x ...) M)</code></pre>
<p>The <a href="https://github.com/esilkensen/cwc/blob/master/src/a.rkt#L12">A(CS) language</a>
 that results from unCPSing the CPS(CS) language holds some interesting 
properties. It maintains the sequential structure of CPS code 
implicitly, without continuations. Programs in the A(CS) language are 
constrained such that non-value <code>M</code> terms (computations) must
 be let-bound or appear in tail position. These properties enable 
certain optimizations, such as being able to write abstract machines 
that take larger steps.</p>
<h2 id="direct-anf-translation">Direct ANF translation</h2>
<p>So far, in order to translate into the A(CS) language we've had to convert to CPS, simplify administrative <code>λ</code>s, and translate out of CPS via the unCPS function <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-10-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math display=&quot;inline&quot; xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow&gt;&lt;mi&gt;U&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-78" style="width: 1.085em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.812em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.319em, 1000.81em, 2.349em, -1000em); top: -2.165em; left: 0em;"><span class="mrow" id="MathJax-Span-79"><span class="mrow" id="MathJax-Span-80"><span class="mi" id="MathJax-Span-81" style="font-family: MathJax_Math; font-style: italic;">U<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.084em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.165em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.1em; border-left: 0px solid; width: 0px; height: 1.073em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mi>U</mi></mrow></math></span></span><script type="math/mml" id="MathJax-Element-10"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mi>U</mi></mrow></math></script>.
 One must wonder, can we forgo CPS completely and translate CS to A(CS) 
in one source-level pass? Flanagan et. al. show this is possible by 
presenting a strongly normalizing A-reduction relation which takes CS 
terms to A(CS) terms using the evaluation context <code>ε</code>. The evaluation context <code>ε</code> is defined such that the holes represent the next reducible expression according to the original CS language's <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-11-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math display=&quot;inline&quot; xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;mrow&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;mi&gt;S&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mi&gt;E&lt;/mi&gt;&lt;mi&gt;K&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-82" style="width: 4.602em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.463em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.297em, 1003.46em, 2.496em, -1000em); top: -2.165em; left: 0em;"><span class="mrow" id="MathJax-Span-83"><span class="mrow" id="MathJax-Span-84"><span class="msub" id="MathJax-Span-85"><span style="display: inline-block; position: relative; width: 1.783em; height: 0px;"><span style="position: absolute; clip: rect(3.137em, 1000.76em, 4.189em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-86" style="font-family: MathJax_Math; font-style: italic;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.045em;"></span></span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -3.85em; left: 0.715em;"><span class="mrow" id="MathJax-Span-87"><span class="mi" id="MathJax-Span-88" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.032em;"></span></span><span class="mi" id="MathJax-Span-89" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">S<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.023em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span><span class="mi" id="MathJax-Span-90" style="font-family: MathJax_Math; font-style: italic;">E<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.026em;"></span></span><span class="mi" id="MathJax-Span-91" style="font-family: MathJax_Math; font-style: italic;">K<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.04em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.165em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.295em; border-left: 0px solid; width: 0px; height: 1.297em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><mrow><msub><mi>C</mi><mrow><mi>C</mi><mi>S</mi></mrow></msub><mi>E</mi><mi>K</mi></mrow></math></span></span><script type="math/mml" id="MathJax-Element-11"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><mrow><msub><mi>C</mi><mrow><mi>C</mi><mi>S</mi></mrow></msub><mi>E</mi><mi>K</mi></mrow></math></script> machine. For instance, when the <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-12-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math display=&quot;inline&quot; xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;mrow&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;mi&gt;S&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mi&gt;E&lt;/mi&gt;&lt;mi&gt;K&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-92" style="width: 4.602em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.463em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.297em, 1003.46em, 2.496em, -1000em); top: -2.165em; left: 0em;"><span class="mrow" id="MathJax-Span-93"><span class="mrow" id="MathJax-Span-94"><span class="msub" id="MathJax-Span-95"><span style="display: inline-block; position: relative; width: 1.783em; height: 0px;"><span style="position: absolute; clip: rect(3.137em, 1000.76em, 4.189em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-96" style="font-family: MathJax_Math; font-style: italic;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.045em;"></span></span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -3.85em; left: 0.715em;"><span class="mrow" id="MathJax-Span-97"><span class="mi" id="MathJax-Span-98" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.032em;"></span></span><span class="mi" id="MathJax-Span-99" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">S<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.023em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span><span class="mi" id="MathJax-Span-100" style="font-family: MathJax_Math; font-style: italic;">E<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.026em;"></span></span><span class="mi" id="MathJax-Span-101" style="font-family: MathJax_Math; font-style: italic;">K<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.04em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.165em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.295em; border-left: 0px solid; width: 0px; height: 1.297em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><mrow><msub><mi>C</mi><mrow><mi>C</mi><mi>S</mi></mrow></msub><mi>E</mi><mi>K</mi></mrow></math></span></span><script type="math/mml" id="MathJax-Element-12"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><mrow><msub><mi>C</mi><mrow><mi>C</mi><mi>S</mi></mrow></msub><mi>E</mi><mi>K</mi></mrow></math></script> machine sees a term <code>(if0 (- 1 2) 2 3)</code> it will reduce <code>(- 1 2)</code> first.</p>
<pre><code>ε ::= [] | (let (x ε) M) | (if0 ε M M) | (F V ... ε M ...)
      where F = V or F = O</code></pre>
<p>The idea is to create an reduction relation, A-Reduction, where we 
bind intermediate computations found in context holes to variables and 
replace these computations with their binding variables. This results in
 programs with a linearized control flow that only require one 
continuation structure in the corresponding abstract machine 
implementation (<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-13-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math display=&quot;inline&quot; xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;/msub&gt;&lt;mi&gt;E&lt;/mi&gt;&lt;mi&gt;K&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-102" style="width: 3.791em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.868em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.297em, 1002.87em, 2.484em, -1000em); top: -2.165em; left: 0em;"><span class="mrow" id="MathJax-Span-103"><span class="mrow" id="MathJax-Span-104"><span class="msub" id="MathJax-Span-105"><span style="display: inline-block; position: relative; width: 1.164em; height: 0px;"><span style="position: absolute; clip: rect(3.137em, 1000.76em, 4.189em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-106" style="font-family: MathJax_Math; font-style: italic;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.045em;"></span></span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.715em;"><span class="mi" id="MathJax-Span-107" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">a</span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span><span class="mi" id="MathJax-Span-108" style="font-family: MathJax_Math; font-style: italic;">E<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.026em;"></span></span><span class="mi" id="MathJax-Span-109" style="font-family: MathJax_Math; font-style: italic;">K<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.04em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.165em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.279em; border-left: 0px solid; width: 0px; height: 1.281em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><mrow><msub><mi>C</mi><mi>a</mi></msub><mi>E</mi><mi>K</mi></mrow></math></span></span><script type="math/mml" id="MathJax-Element-13"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><mrow><msub><mi>C</mi><mi>a</mi></msub><mi>E</mi><mi>K</mi></mrow></math></script>).</p>
<p>A-Reduction:</p>
<pre><code>(A1)  ε[(let (x M) N)] →a (let (x M) ε[N])
                          where ε ≠ [] and x ∉ FreeVariables(ε)
(A2)  ε[(if0 V M1 M2)] →a (if0 V ε[M1] ε[M2])
(A3)  ε[(F V ...)]     →a (let (t (F V ...)) ε[t])
                          where F = V or F = O, ε ≠ [], t ∉ FreeVariables(ε),
                                ∀ ε' . ε ≠ ε'[(let (z []) M)]</code></pre>
<p>The A-Reduction is comprised of 3 rules:</p>
<ul>
<li>(A1) moves let-bindings out of the current context, as long as we make sure to pick a fresh <code>x</code> and substitute it in <code>N</code>. This rule helps us lift <code>let</code> terms out of computational locations so that we no longer need the <code>lt</code> continuation found in the <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-14-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math display=&quot;inline&quot; xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;mrow&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;mi&gt;S&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mi&gt;E&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-110" style="width: 3.358em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.543em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.297em, 1002.54em, 2.496em, -1000em); top: -2.165em; left: 0em;"><span class="mrow" id="MathJax-Span-111"><span class="mrow" id="MathJax-Span-112"><span class="msub" id="MathJax-Span-113"><span style="display: inline-block; position: relative; width: 1.783em; height: 0px;"><span style="position: absolute; clip: rect(3.137em, 1000.76em, 4.189em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-114" style="font-family: MathJax_Math; font-style: italic;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.045em;"></span></span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -3.85em; left: 0.715em;"><span class="mrow" id="MathJax-Span-115"><span class="mi" id="MathJax-Span-116" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.032em;"></span></span><span class="mi" id="MathJax-Span-117" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">S<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.023em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span><span class="mi" id="MathJax-Span-118" style="font-family: MathJax_Math; font-style: italic;">E<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.026em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.165em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.295em; border-left: 0px solid; width: 0px; height: 1.297em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><mrow><msub><mi>C</mi><mrow><mi>C</mi><mi>S</mi></mrow></msub><mi>E</mi></mrow></math></span></span><script type="math/mml" id="MathJax-Element-14"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><mrow><msub><mi>C</mi><mrow><mi>C</mi><mi>S</mi></mrow></msub><mi>E</mi></mrow></math></script> machine.</li>
<li>(A2) moves <code>if</code> terms out of the current context, duplicating the context for each branch. This rule enables us to get ride of the <code>if</code> continuation found in the <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-15-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math display=&quot;inline&quot; xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;mrow&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;mi&gt;S&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mi&gt;E&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-119" style="width: 3.358em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.543em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.297em, 1002.54em, 2.496em, -1000em); top: -2.165em; left: 0em;"><span class="mrow" id="MathJax-Span-120"><span class="mrow" id="MathJax-Span-121"><span class="msub" id="MathJax-Span-122"><span style="display: inline-block; position: relative; width: 1.783em; height: 0px;"><span style="position: absolute; clip: rect(3.137em, 1000.76em, 4.189em, -1000em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-123" style="font-family: MathJax_Math; font-style: italic;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.045em;"></span></span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span><span style="position: absolute; top: -3.85em; left: 0.715em;"><span class="mrow" id="MathJax-Span-124"><span class="mi" id="MathJax-Span-125" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.032em;"></span></span><span class="mi" id="MathJax-Span-126" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">S<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.023em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.004em;"></span></span></span></span><span class="mi" id="MathJax-Span-127" style="font-family: MathJax_Math; font-style: italic;">E<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.026em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.165em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.295em; border-left: 0px solid; width: 0px; height: 1.297em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><mrow><msub><mi>C</mi><mrow><mi>C</mi><mi>S</mi></mrow></msub><mi>E</mi></mrow></math></span></span><script type="math/mml" id="MathJax-Element-15"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><mrow><msub><mi>C</mi><mrow><mi>C</mi><mi>S</mi></mrow></msub><mi>E</mi></mrow></math></script> machine.</li>
<li>(A3) binds the result of intermediate computations to variables and 
lifts them out of the current context. We need to make sure that the 
hole in <code>ε</code> isn't of the shape <code>ε'[(let (x []) M)]</code> for some arbitrary <code>ε'</code>,
 or else we would be unnecessarily be introducing let-bindings. This 
rule ensures that applications are only found in the body of <code>let</code> expressions or in tail position.</li>
</ul>
<p>All the rules enforce the side-condition that <code>ε</code> isn't empty because if it was the reduction relation would never terminate.</p>
<p>The A-Reduction is a reduction relation over the entire program term, and it turns out that once we apply any of the <code>→a</code> rules, we are left with a term that can't be matched by the <code>ε</code> context. This is due to the fact that the <code>ε</code> context only matches terms not yet in ANF and the <code>→a</code>
 rules introduce terms in ANF. In order to model this in Redex, we were 
forced to add a ψ context to let us match over terms already in ANF:</p>
<pre><code>ψ ::= [] | (let (x V) ψ) | (let (x (F V ...)) ψ) | (if0 V ψ M) | (if0 V M ψ)
      where F = V or F = O</code></pre>
<p>The A-Reduction rules can then be wrapped in a ψ context, allowing 
for terms already in ANF to be put in the ψ context so reductions on 
non-ANF terms can be made. This results in the <a href="https://github.com/esilkensen/cwc/blob/master/src/a.rkt#L57">Adapted A-Reduction</a> which we were able to model in a straight forward manner in Redex:</p>
<pre><code>ψ[M1] → ψ[M2] when M1 →a M2</code></pre>
<h2 id="typos">Typos</h2>
<p>The typos we found in “<a href="https://dl.acm.org/citation.cfm?id=155113">The Essence of Compiling with Continuations</a>” are quite minor, the only reason I mention them is to motivate Redex's LaTeX exporting features.</p>
<p>In the CPS transformation figure of the paper (Figure 3), the auxiliary <code>Φ</code> function reads</p>
<pre><code>Φ[λ x . M] = λ k x . F[M]</code></pre>
<p>failing to use the <code>k</code> variable bound by the <code>λ</code>, and should hence read</p>
<pre><code>Φ[λ x . M] = λ k x . (F[M] k)</code></pre>
<p>Additionally the <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-16-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math display=&quot;inline&quot; xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow&gt;&lt;mi&gt;U&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-128" style="width: 1.085em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.812em; height: 0px; font-size: 132%;"><span style="position: absolute; clip: rect(1.319em, 1000.81em, 2.349em, -1000em); top: -2.165em; left: 0em;"><span class="mrow" id="MathJax-Span-129"><span class="mrow" id="MathJax-Span-130"><span class="mi" id="MathJax-Span-131" style="font-family: MathJax_Math; font-style: italic;">U<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.084em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.165em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.1em; border-left: 0px solid; width: 0px; height: 1.073em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mi>U</mi></mrow></math></span></span><script type="math/mml" id="MathJax-Element-16"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mi>U</mi></mrow></math></script> function calls an auxiliary <code>Ψ</code> function that unCPSs values. The <code>λ</code> case of <code>Ψ</code> reads <code>Ψ[λ k x . P] = λ x . U[M]</code> but clearly should be <code>Ψ[λ k x . P] = λ x . U[P]</code>.</p>
<p>If Redex was available in 1993, such typos could have have been 
avoided by creating Redex models and then exporting them as LaTeX 
figures, in the flavor of <a href="http://users.eecs.northwestern.edu/~robby/lightweight-metatheory/">Run Your Research</a>.</p>
<h2 id="resources-and-further-reading">Resources and Further Reading</h2>
<ul>
<li><a href="https://github.com/esilkensen/cwc">Our Redex Models on GitHub</a></li>
<li>Matt Might’s blog post on <a href="http://matt.might.net/articles/a-normalization/">A Normalization</a></li>
<li>Matt Might’s blog posts on CPS: <a href="http://matt.might.net/articles/by-example-continuation-passing-style/">CPS by example</a>, <a href="http://matt.might.net/articles/cps-conversion/">compiling with CPS</a> and <a href="http://matt.might.net/articles/programming-with-continuations--exceptions-backtracking-search-threads-generators-coroutines/">implementing language features using CPS</a>.</li>
<li>The paper: “<a href="https://dl.acm.org/citation.cfm?id=155113">The Essence of Compiling with Continuations</a>”</li>
<li>A preceding paper that introduces unCPS: “<a href="https://dl.acm.org/citation.cfm?id=141563">Reasoning about programs in continuation-passing style</a>”</li>
<li><a href="http://www.amazon.com/Semantics-Engineering-Redex-Matthias-Felleisen/dp/0262062755/">Semantics Engineering With PLT Redex</a> textbook</li>
</ul>
</article>
</section>

<footer id="footer" class="wrapper">
</footer>


    <script src="../MathJax.js" id=""></script>

<div style="position: absolute; width: 0px; height: 0px; overflow: hidden; padding: 0px; border: 0px none; margin: 0px;"><div id="MathJax_Font_Test" style="position: absolute; visibility: hidden; top: 0px; left: 0px; width: auto; padding: 0px; border: 0px none; margin: 0px; white-space: nowrap; text-align: left; text-indent: 0px; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; font-size: 40px; font-weight: normal; font-style: italic; font-size-adjust: none; font-family: MathJax_Math, sans-serif;"></div></div></body></html>
